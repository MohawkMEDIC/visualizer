@model IQueryable<MYST.OpAdmin.DAL.AuditSummaryVw>
@{
    var grid = new System.Web.Helpers.WebGrid(Model, defaultSort: "CreationTimestamp", rowsPerPage: Int32.Parse(Request.QueryString["count"] ?? "20"), selectionFieldName: "AuditId");
    grid.Pager(WebGridPagerModes.All, "First", "Previous", "Next", "Last");
    if (Request.QueryString[grid.SortDirectionFieldName].IsEmpty())
    {
        grid.SortDirection = SortDirection.Descending;
    }
  
}
<div id="view" class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <div class="panel-group" id="searchAccordion">
                <div class="panel panel-default">
                    <div class="panel-heading">

                        <h3 class="panel-title">
                            <a href="#eventSearchParms" data-toggle="collapse" data-parent="searchAccordion"><span class="glyphicon glyphicon-filter"></span> Event Criteria</a></h3>
                    </div>
                    <div class="panel-body panel-collapse collapse @String.Format("{0}", ViewBag.ShowRootParms?"in":"")" id="eventSearchParms">
                        <table class="table">
                            <tr>
                                <th style="width: 20%">Status <span class="label label-info" data-toggle="tooltip" data-original-title="When you select multiple the filter will match ANY of the selected items">(OR)</span></th>
                                <td style="width: 80%">
                                    <select data-filter-by="StatusCode" data-filter-summarize="#querySummary" style="width: 100%; display: none" multiple="multiple">
                                        @*<option value="">Any</option>*@
                                        <option value="ARCHIVED">Archived</option>
                                        <option value="OBSOLETE">Deleted</option>
                                        <option value="NEW">New</option>
                                        <option value="ACTIVE">Reviewed</option>
                                        <option value="HELD">Starred</option>
                                        <option value="SYSTEM">System</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>Is Alert</th>
                                <td>
                                    <input data-filter-by="IsAlert" data-filter-summarize="#querySummary" value="true" type="checkbox" />
                                </td>
                            </tr>
                            <tr>
                                <th>Date (from)</th>
                                <td>
                                    <input data-filter-by="CreationTimestamp" data-filter-summarize="#querySummary" type="text" data-filter-type="date" class="datepicker datepicker-pointer form-control" data-date-format=">yy-mm-dd" readonly="readonly" />
                                </td>
                            </tr>
                            <tr>
                                <th>Date (to)</th>
                                <td>
                                    <input data-filter-by="@@CreationTimestamp" data-filter-summarize="#querySummary" type="text" data-filter-type="date" class="datepicker datepicker-pointer form-control" data-date-format="<yy-mm-dd" readonly="readonly" />
                                </td>
                            </tr>
                            <tr>
                                <th>Classification <span class="label label-info" data-toggle="tooltip" data-original-title="When you select multiple the filter will match ANY of the selected items">(OR)</span></th>
                                <td>
                                    <select data-filter-by="EventCode" data-filter-summarize="#querySummary" style="width: 100%; display: none" multiple="multiple">
                                        @foreach (var n in ViewBag.EventCode)
                                        {
                                            <option value="@n">@n</option>
                                        }
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>Action <span class="label label-info" data-toggle="tooltip" data-original-title="When you select multiple the filter will match ANY of the selected items">(OR)</span></th>
                                <td>
                                    <select data-filter-by="ActionCode" data-filter-summarize="#querySummary" style="width: 100%; display: none" multiple="multiple">
                                        @foreach (var n in ViewBag.ActionCode)
                                        {
                                            <option value="@n">@n</option>
                                        }
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>Outcome <span class="label label-info" data-toggle="tooltip" data-original-title="When you select multiple the filter will match ANY of the selected items">(OR)</span></th>
                                <td>
                                    <select data-filter-by="OutcomeCode" data-filter-summarize="#querySummary" style="width: 100%; display: none" multiple="multiple">
                                        @foreach (var n in ViewBag.OutcomeCode)
                                        {
                                            <option value="@n">@n</option>
                                        }

                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>Event Type <span class="label label-info" data-toggle="tooltip" data-original-title="When you select multiple the filter will match ANY of the selected items">(OR)</span></th>
                                <td>
                                    <select data-filter-by="EventType" data-filter-summarize="#querySummary" style="width: 100%; display: none" multiple="multiple">
                                        @foreach (var n in ViewBag.EventType)
                                        {
                                            <option value="@n">@n</option>
                                        }
                                    </select>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title"><a href="#participantSearchParms" data-toggle="collapse" data-parent="searchAccordion"><span class="glyphicon glyphicon-filter"></span> Participant Criteria <small>'Has A' participant where</small></a></h3>
                    </div>
                    <div class="panel-body panel-collapse collapse @String.Format("{0}", ViewBag.ShowParticipantParms?"in":"")" id="participantSearchParms">
                        <table class="table">
                            <tr>
                                <th>Participant Role </th>
                                <td>
                                    <select data-filter-by="Participant::RoleCodeDisplay" data-filter-summarize="#querySummary" style="width: 100%; display: none">
                                        <option value="">Any</option>
                                        @foreach (var n in ViewBag.ParticipantRoleCode)
                                        {
                                            <option value="@n">@n</option>
                                        }
                                    </select>

                                </td>
                            </tr>
                            <tr>
                                <th style="width: 20%">On Access Pt. <span class="label label-info" data-toggle="tooltip" data-original-title="You can select on text semantics: ! = NOT, ~ = LIKE, ',' = OR. For example: 'Tim,~Jim,!Bob' = Tim OR LIKE Jim OR NOT Bob ">(TEXT)</span></th>
                                <td style="width: 80%">
                                    <input type="text" class="form-control" data-filter-by="Participant::NetworkAccessPoint" data-filter-summarize="#querySummary" />
                                </td>
                            </tr>
                            <tr>
                                <th>Identifier <span class="label label-info" data-toggle="tooltip" data-original-title="When you select multiple the filter will match ANY of the selected items">(OR)</span></th>
                                <td>
                                    <select data-filter-by="Participant::RawUserId" data-filter-summarize="#querySummary" style="width: 100%; display: none" multiple="multiple">
                                        @foreach (var n in ViewBag.UserId)
                                        {
                                            <option value="@n">@n</option>
                                        }
                                    </select>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading">

                        <h3 class="panel-title"><a href="#objectSearchParms" data-toggle="collapse" data-parent="searchAccordion"><span class="glyphicon glyphicon-filter"></span> Object Criteria <small>'Has A' Object where</small></a></h3>
                    </div>
                    <div class="panel-body panel-collapse collapse  @String.Format("{0}", ViewBag.ShowObjectParms?"in":"")" id="objectSearchParms">
                        <table class="table">
                            <tr>
                                <th style="width: 20%">Identifier <span class="label label-info" data-toggle="tooltip" data-original-title="You can select on text semantics: ! = NOT, ~ = LIKE, ',' = OR. For example: 'Tim,~Jim,!Bob' = Tim OR LIKE Jim OR NOT Bob ">(TEXT)</span></th>
                                <td style="width: 30%">
                                    <input class="form-control" type="text" style="width: 100%" data-filter-by="Object::ExternalIdentifier" data-filter-summarize="#querySummary" />
                                </td>
                                <th style="width: 20%">Of Type</th>
                                <td style="width: 30%">
                                    <select data-filter-by="Object::IdTypeCodeDisplayName" data-filter-summarize="#querySummary" style="width: 100%; display: none">
                                        <option value="">Any</option>
                                        @foreach (var n in ViewBag.ObjectIdTypeCode)
                                        {
                                            <option value="@n">@n</option>
                                        }
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>Role <span class="label label-info" data-toggle="tooltip" data-original-title="When you select multiple the filter will match ANY of the selected items">(OR)</span></th>
                                <td colspan="3">
                                    <select data-filter-by="Object::RoleCode" data-filter-summarize="#querySummary" style="width: 100%; display: none" multiple="multiple">
                                        @foreach (var n in ViewBag.ObjectRoleCode)
                                        {
                                            <option value="@n">@n</option>
                                        }
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>Type Code <span class="label label-info" data-toggle="tooltip" data-original-title="When you select multiple the filter will match ANY of the selected items">(OR)</span></th>
                                <td colspan="3">
                                    <select data-filter-by="Object::TypeCode" data-filter-summarize="#querySummary" style="width: 100%; display: none" multiple="multiple">
                                        @foreach (var n in ViewBag.ObjectTypeCode)
                                        {
                                            <option value="@n">@n</option>
                                        }
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <th>Lifecycle <span class="label label-info" data-toggle="tooltip" data-original-title="When you select multiple the filter will match ANY of the selected items">(OR)</span></th>
                                <td colspan="3">
                                    <select data-filter-by="Object::LifecycleCode" data-filter-summarize="#querySummary" style="width: 100%; display: none" multiple="multiple">
                                        @foreach (var n in ViewBag.ObjectLifecycle)
                                        {
                                            <option value="@n">@n</option>
                                        }
                                    </select>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>


            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            Search Filter:
            <div class="well" id="querySummary"></div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">

            <button class="btn btn-primary" style="float:right" data-original-title="Submit the query to the repository" data-toggle="tooltip" onclick="javascript:AuditTool.AdvancedSearch(this, AuditTool.ViewFilter);"><span class="glyphicon glyphicon-search"></span> Search</button>
            <button class="btn btn-info" style="float:right" data-original-title="Submit the query and send to chart view" data-toggle="tooltip" onclick="javascript:AuditTool.ShowStatsView(AuditTool.ViewFilter);"><span class="glyphicon glyphicon-stats"></span> Chart</button>
            <div style="clear:both" ></div>
        </div>
    </div>
    <div class="row" style="margin-top:8px">
        <div class="col-md-12">
            <div class="panel-group" id="searchResults">

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title"><a href="#results" data-toggle="collapse" data-parent="searchResults">Search Results (@Model.Count() records)</a></h3>
                    </div>
                    <div class="panel-body panel-collapse collapse @String.Format("{0}", Model.Count() > 0? "in" :"")" id="results">
                        @grid.GetHtml(
                                tableStyle: "table table-striped",
                                mode: WebGridPagerModes.Numeric,
                                footerStyle: "grid-footer",
                                headerStyle: "grid-header",
                                htmlAttributes: new { id = "resultTable" },
                                columns: grid.Columns(
                                grid.Column(
                                columnName: "StatusCode",
                                header: "Status",
                                style: "width:350px",
                                format: (x) => new HtmlString(MYST.OpAdmin.UtilityFunctions.HtmlDisplayUtils.BuildAuditStatusColumnStyle(x.Value))
                                ),
                                grid.Column(
                                columnName: "IsAlert",
                                header: "Alert",
                                style: "width:5%",
                                format: (x) => new HtmlString(MYST.OpAdmin.UtilityFunctions.HtmlDisplayUtils.BuildAuditAlertColumnStyle(x.Value))
                                ),
                                    grid.Column(
                                    columnName: "CreationTimestamp",
                                    header: "Timestamp"
                                    ),
                                    grid.Column(
                                    header: "Classification",
                                    columnName: "EventCode"
                                    ),
                                    grid.Column(
                                    header: "Action",
                                    columnName: "ActionCode"
                                    ),
                                    grid.Column(
                                    header: "Outcome",
                                    columnName: "OutcomeCode",
                                    format: (x) => new HtmlString(String.Format("<span class=\"{1}\">{0}</span>", x.Value.OutcomeCode.ToString(), x.Value.OutcomeCode.ToString() == "Major Fail" ? "label label-danger" : x.Value.OutcomeCode.ToString() == "Success" ? "label label-success" : "label label-warning"))
                                    ),
                                    grid.Column(
                                    header: "Event Type",
                                    columnName: "EventType"
                                    ),
                                    grid.Column(
                                    header: "Actions",
                                    columnName: "AuditId",
                                    canSort: false,
                                    format: (item) => new HtmlString(MYST.OpAdmin.UtilityFunctions.HtmlDisplayUtils.BuildAuditColumnAction(item.Value)))
                                )
                            )
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
